---
layout: default
title: Search
permalink: /search/
---

<div class="search-page">
  <p class="search-hint-heading">Not sure where to start?</p>
  <p class="search-hint">Search our archive, or browse by category: <a href="{{ site.baseurl }}/category/politics/">Politics</a>, <a href="{{ site.baseurl }}/category/business/">Business</a>, <a href="{{ site.baseurl }}/category/culture/">Culture</a>.</p>

  <div class="search-input-wrapper">
    <input type="text" class="search-input" id="search-input" placeholder="Search articles..." autocomplete="off" autofocus>
  </div>

  <div class="search-results" id="search-results"></div>
</div>

<script>
(function() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');
  const baseUrl = document.querySelector('meta[name="base-url"]')?.content || '';

  let searchData = null;
  let debounceTimer = null;

  // Load search data immediately
  fetch(`${baseUrl}/search.json`)
    .then(response => response.json())
    .then(data => {
      searchData = data;
      // Check for query param on load
      const urlParams = new URLSearchParams(window.location.search);
      const initialQuery = urlParams.get('q') || '';
      if (initialQuery) {
        searchInput.value = initialQuery;
        performSearch(initialQuery);
      }
    })
    .catch(error => {
      console.error('Failed to load search data:', error);
    });

  function performSearch(query) {
    if (!query.trim()) {
      searchResults.innerHTML = '';
      return;
    }

    if (!searchData) {
      searchResults.innerHTML = '<p class="search-message">Loading...</p>';
      return;
    }

    const lowerQuery = query.toLowerCase();
    const results = searchData.filter(post => {
      return post.title.toLowerCase().includes(lowerQuery) ||
             post.excerpt.toLowerCase().includes(lowerQuery) ||
             (post.author && post.author.toLowerCase().includes(lowerQuery)) ||
             (post.category && post.category.toLowerCase().includes(lowerQuery));
    });

    if (results.length === 0) {
      searchResults.innerHTML = '<p class="search-message">No results found.</p>';
      return;
    }

    searchResults.innerHTML = results.map(post => `
      <a href="${post.url}" class="search-result">
        <span class="search-result-title">${post.title}</span>
        <span class="search-result-excerpt">${post.excerpt}</span>
        ${post.author ? `<span class="search-result-meta">By ${post.author}</span>` : ''}
      </a>
    `).join('');
  }

  searchInput.addEventListener('input', (e) => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      performSearch(e.target.value);
    }, 150);
  });
})();
</script>
